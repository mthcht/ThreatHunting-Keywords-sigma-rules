title: Simple keyword detection rule for wePWNise
id: 588da774-c1b8-4f28-a466-217cc0532a3b
status: experimental
description:
- '''wePWNise is proof-of-concept Python script which generates VBA code that can
  be used in Office macros or templates. It was designed with automation and integration
  in mind. targeting locked down environment scenarios. The tool enumerates Software
  Restriction Policies (SRPs) and EMET mitigations and dynamically identifies safe
  binaries to inject payloads into. wePWNise integrates with existing exploitation
  frameworks (e.g. Metasploit. Cobalt Strike) and it also accepts any custom payload
  in raw format.'''
references:
- https://github.com/FSecureLABS/wePWNise
author: '@mthcht'
date: 2023/07/30
modified: 2023/09/06
tags:
- attack.T1059
- attack.T1203
- attack.T1564.001
- attack.TA0002
- attack.TA0003
- attack.TA0007
logsource:
  category:
  - endpoint
falsepositives:
- Unknown
level:
- Unknown
detection:
  selection:
    Image:
    - '*wePWNise*'
    OriginalFileName:
    - '*wePWNise*'
    CurrentDirectory:
    - '*wePWNise*'
    ParentImage:
    - '*wePWNise*'
    ParentCommandLine:
    - '*wePWNise*'
    TargetFilename:
    - '*wePWNise*'
    Signature:
    - '*wePWNise*'
    signature:
    - '*wePWNise*'
    ImageLoaded:
    - '*wePWNise*'
    Company:
    - '*wePWNise*'
    Description:
    - '*wePWNise*'
    description:
    - '*wePWNise*'
    CommandLine:
    - '*wePWNise*'
    SourceImage:
    - '*wePWNise*'
    TargetImage:
    - '*wePWNise*'
    CallTrace:
    - '*wePWNise*'
    TargetObject:
    - '*wePWNise*'
    Details:
    - '*wePWNise*'
    PipeName:
    - '*wePWNise*'
    Consumer:
    - '*wePWNise*'
    Destination:
    - '*wePWNise*'
    Name:
    - '*wePWNise*'
    Query:
    - '*wePWNise*'
    NewName:
    - '*wePWNise*'
    StartAddress:
    - '*wePWNise*'
    StartModule:
    - '*wePWNise*'
    StartFunction:
    - '*wePWNise*'
    SourceHostname:
    - '*wePWNise*'
    Device:
    - '*wePWNise*'
    file_name:
    - '*wePWNise*'
    file_path:
    - '*wePWNise*'
    process:
    - '*wePWNise*'
    original_file_name:
    - '*wePWNise*'
    parent_process:
    - '*wePWNise*'
    process_path:
    - '*wePWNise*'
    service_path:
    - '*wePWNise*'
    registry_path:
    - '*wePWNise*'
    registry_value_data:
    - '*wePWNise*'
    registry_value_name:
    - '*wePWNise*'
    ContextInfo:
    - '*wePWNise*'
    Payload:
    - '*wePWNise*'
    ScriptBlockText:
    - '*wePWNise*'
    ServerName:
    - '*wePWNise*'
    TransportName:
    - '*wePWNise*'
    NewProcessName:
    - '*wePWNise*'
    ParentProcessName:
    - '*wePWNise*'
    Application:
    - '*wePWNise*'
    Product Name:
    - '*wePWNise*'
    Threat Name:
    - '*wePWNise*'
    Process Name:
    - '*wePWNise*'
    Path:
    - '*wePWNise*'
    ImagePath:
    - '*wePWNise*'
    ServiceName:
    - '*wePWNise*'
    ProcessPath:
    - '*wePWNise*'
    AppName:
    - '*wePWNise*'
    AppPath:
    - '*wePWNise*'
    ModulePath:
    - '*wePWNise*'
    registry.data.strings:
    - '*wePWNise*'
    registry.path:
    - '*wePWNise*'
    registry.value:
    - '*wePWNise*'
    process.args:
    - '*wePWNise*'
    process.command_line:
    - '*wePWNise*'
    process.env_vars:
    - '*wePWNise*'
    process.io.text:
    - '*wePWNise*'
    process.executable:
    - '*wePWNise*'
    process.name:
    - '*wePWNise*'
    process.title:
    - '*wePWNise*'
    pe.company:
    - '*wePWNise*'
    pe.description:
    - '*wePWNise*'
    pe.original_file_name:
    - '*wePWNise*'
    pe.product:
    - '*wePWNise*'
    os.full:
    - '*wePWNise*'
    host.hostname:
    - '*wePWNise*'
    file.fork_name:
    - '*wePWNise*'
    file.name:
    - '*wePWNise*'
    file.path:
    - '*wePWNise*'
    file.target_path:
    - '*wePWNise*'
    email.attachments.file.name:
    - '*wePWNise*'
    email.subject:
    - '*wePWNise*'
    dll.path:
    - '*wePWNise*'
    device.model.name:
    - '*wePWNise*'
    container.image.name:
    - '*wePWNise*'
    container.name:
    - '*wePWNise*'
    object:
    - '*wePWNise*'
  condition: selection
fields:
- Image
- OriginalFileName
- CurrentDirectory
- ParentImage
- ParentCommandLine
- TargetFilename
- Signature
- signature
- ImageLoaded
- Company
- Description
- description
- CommandLine
- SourceImage
- TargetImage
- CallTrace
- TargetObject
- Details
- PipeName
- Consumer
- Destination
- Name
- Query
- NewName
- StartAddress
- StartModule
- StartFunction
- SourceHostname
- Device
- file_name
- file_path
- process
- original_file_name
- parent_process
- process_path
- service_path
- registry_path
- registry_value_data
- registry_value_name
- ContextInfo
- Payload
- ScriptBlockText
- ServerName
- TransportName
- NewProcessName
- ParentProcessName
- Application
- Product Name
- Threat Name
- Process Name
- Path
- ImagePath
- ServiceName
- ProcessPath
- AppName
- AppPath
- ModulePath
- registry.data.strings
- registry.path
- registry.value
- process.args
- process.command_line
- process.env_vars
- process.io.text
- process.executable
- process.name
- process.title
- pe.company
- pe.description
- pe.original_file_name
- pe.product
- os.full
- host.hostname
- file.fork_name
- file.name
- file.path
- file.target_path
- email.attachments.file.name
- email.subject
- dll.path
- device.model.name
- container.image.name
- container.name
- object
