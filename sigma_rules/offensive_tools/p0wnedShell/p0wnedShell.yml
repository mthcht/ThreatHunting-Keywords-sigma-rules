title: Simple keyword detection rule for p0wnedShell
id: 8a627924-3ff7-42d0-b7a6-d524d0e476c0
status: experimental
description:
- '''p0wnedShell is an offensive PowerShell host application written in C# that does
  not rely on powershell.exe but runs powershell commands and functions within a powershell
  runspace environment (.NET). It has a lot of offensive PowerShell modules and binaries
  included to make the process of Post Exploitation easier. What we tried was to build
  an ?all in one? Post Exploitation tool which we could use to bypass all mitigations
  solutions (or at least some off). and that has all relevant tooling included. You
  can use it to perform modern attacks within Active Directory environments and create
  awareness within your Blue team so they can build the right defense strategies.'''
references:
- https://github.com/Cn33liz/p0wnedShell
author: '@mthcht'
date: 2023/07/30
modified: 2023/08/06
tags:
- attack.T1059
- attack.T1086
- attack.T1106
- attack.T1566
- attack.TA0002
- attack.TA0003
- attack.TA0007
logsource:
  category:
  - endpoint
  - network
falsepositives:
- Unknown
level:
- Unknown
detection:
  selection:
    Image:
    - '*p0wnedShell*'
    OriginalFileName:
    - '*p0wnedShell*'
    CurrentDirectory:
    - '*p0wnedShell*'
    ParentImage:
    - '*p0wnedShell*'
    ParentCommandLine:
    - '*p0wnedShell*'
    TargetFilename:
    - '*p0wnedShell*'
    Signature:
    - '*p0wnedShell*'
    signature:
    - '*p0wnedShell*'
    ImageLoaded:
    - '*p0wnedShell*'
    Company:
    - '*p0wnedShell*'
    Description:
    - '*p0wnedShell*'
    description:
    - '*p0wnedShell*'
    CommandLine:
    - '*p0wnedShell*'
    SourceImage:
    - '*p0wnedShell*'
    TargetImage:
    - '*p0wnedShell*'
    CallTrace:
    - '*p0wnedShell*'
    TargetObject:
    - '*p0wnedShell*'
    Details:
    - '*p0wnedShell*'
    PipeName:
    - '*p0wnedShell*'
    Consumer:
    - '*p0wnedShell*'
    Destination:
    - '*p0wnedShell*'
    Name:
    - '*p0wnedShell*'
    Query:
    - '*p0wnedShell*'
    NewName:
    - '*p0wnedShell*'
    StartAddress:
    - '*p0wnedShell*'
    StartModule:
    - '*p0wnedShell*'
    StartFunction:
    - '*p0wnedShell*'
    SourceHostname:
    - '*p0wnedShell*'
    Device:
    - '*p0wnedShell*'
    file_name:
    - '*p0wnedShell*'
    file_path:
    - '*p0wnedShell*'
    process:
    - '*p0wnedShell*'
    original_file_name:
    - '*p0wnedShell*'
    parent_process:
    - '*p0wnedShell*'
    process_path:
    - '*p0wnedShell*'
    service_path:
    - '*p0wnedShell*'
    registry_path:
    - '*p0wnedShell*'
    registry_value_data:
    - '*p0wnedShell*'
    registry_value_name:
    - '*p0wnedShell*'
    ContextInfo:
    - '*p0wnedShell*'
    Payload:
    - '*p0wnedShell*'
    ScriptBlockText:
    - '*p0wnedShell*'
    ServerName:
    - '*p0wnedShell*'
    TransportName:
    - '*p0wnedShell*'
    NewProcessName:
    - '*p0wnedShell*'
    ParentProcessName:
    - '*p0wnedShell*'
    Application:
    - '*p0wnedShell*'
    Product Name:
    - '*p0wnedShell*'
    Threat Name:
    - '*p0wnedShell*'
    Process Name:
    - '*p0wnedShell*'
    Path:
    - '*p0wnedShell*'
    ImagePath:
    - '*p0wnedShell*'
    ServiceName:
    - '*p0wnedShell*'
    ProcessPath:
    - '*p0wnedShell*'
    AppName:
    - '*p0wnedShell*'
    AppPath:
    - '*p0wnedShell*'
    ModulePath:
    - '*p0wnedShell*'
    registry.data.strings:
    - '*p0wnedShell*'
    registry.path:
    - '*p0wnedShell*'
    registry.value:
    - '*p0wnedShell*'
    process.args:
    - '*p0wnedShell*'
    process.command_line:
    - '*p0wnedShell*'
    process.env_vars:
    - '*p0wnedShell*'
    process.io.text:
    - '*p0wnedShell*'
    process.executable:
    - '*p0wnedShell*'
    process.name:
    - '*p0wnedShell*'
    process.title:
    - '*p0wnedShell*'
    pe.company:
    - '*p0wnedShell*'
    pe.description:
    - '*p0wnedShell*'
    pe.original_file_name:
    - '*p0wnedShell*'
    pe.product:
    - '*p0wnedShell*'
    os.full:
    - '*p0wnedShell*'
    host.hostname:
    - '*p0wnedShell*'
    file.fork_name:
    - '*p0wnedShell*'
    file.name:
    - '*p0wnedShell*'
    file.path:
    - '*p0wnedShell*'
    file.target_path:
    - '*p0wnedShell*'
    email.attachments.file.name:
    - '*p0wnedShell*'
    email.subject:
    - '*p0wnedShell*'
    dll.path:
    - '*p0wnedShell*'
    device.model.name:
    - '*p0wnedShell*'
    container.image.name:
    - '*p0wnedShell*'
    container.name:
    - '*p0wnedShell*'
    object:
    - '*p0wnedShell*'
    url:
    - '*p0wnedShell*'
    dest_url:
    - '*p0wnedShell*'
    uri:
    - '*p0wnedShell*'
    uri_query:
    - '*p0wnedShell*'
    query:
    - '*p0wnedShell*'
    url_domain:
    - '*p0wnedShell*'
    uri_path:
    - '*p0wnedShell*'
    domain:
    - '*p0wnedShell*'
    QueryName:
    - '*p0wnedShell*'
    QueryResults:
    - '*p0wnedShell*'
    DestinationHostname:
    - '*p0wnedShell*'
    DestinationIp:
    - '*p0wnedShell*'
    http_referrer:
    - '*p0wnedShell*'
    http_referrer_domain:
    - '*p0wnedShell*'
    http_user_agent:
    - '*p0wnedShell*'
    dest_nt_host:
    - '*p0wnedShell*'
    sender:
    - '*p0wnedShell*'
    recipient:
    - '*p0wnedShell*'
    orig_recipient:
    - '*p0wnedShell*'
    subject:
    - '*p0wnedShell*'
    url.domain:
    - '*p0wnedShell*'
    url.full:
    - '*p0wnedShell*'
    url.original:
    - '*p0wnedShell*'
    url.query:
    - '*p0wnedShell*'
    user_agent.original:
    - '*p0wnedShell*'
    network.application:
    - '*p0wnedShell*'
    http.request.body.content:
    - '*p0wnedShell*'
    http.request.referrer:
    - '*p0wnedShell*'
    email.from.address:
    - '*p0wnedShell*'
    dns.question.name:
    - '*p0wnedShell*'
    destination.domain:
    - '*p0wnedShell*'
  condition: selection
fields:
- Image
- OriginalFileName
- CurrentDirectory
- ParentImage
- ParentCommandLine
- TargetFilename
- Signature
- signature
- ImageLoaded
- Company
- Description
- description
- CommandLine
- SourceImage
- TargetImage
- CallTrace
- TargetObject
- Details
- PipeName
- Consumer
- Destination
- Name
- Query
- NewName
- StartAddress
- StartModule
- StartFunction
- SourceHostname
- Device
- file_name
- file_path
- process
- original_file_name
- parent_process
- process_path
- service_path
- registry_path
- registry_value_data
- registry_value_name
- ContextInfo
- Payload
- ScriptBlockText
- ServerName
- TransportName
- NewProcessName
- ParentProcessName
- Application
- Product Name
- Threat Name
- Process Name
- Path
- ImagePath
- ServiceName
- ProcessPath
- AppName
- AppPath
- ModulePath
- registry.data.strings
- registry.path
- registry.value
- process.args
- process.command_line
- process.env_vars
- process.io.text
- process.executable
- process.name
- process.title
- pe.company
- pe.description
- pe.original_file_name
- pe.product
- os.full
- host.hostname
- file.fork_name
- file.name
- file.path
- file.target_path
- email.attachments.file.name
- email.subject
- dll.path
- device.model.name
- container.image.name
- container.name
- object
- url
- dest_url
- uri
- uri_query
- query
- url_domain
- uri_path
- domain
- QueryName
- QueryResults
- DestinationHostname
- DestinationIp
- http_referrer
- http_referrer_domain
- http_user_agent
- dest_nt_host
- sender
- recipient
- orig_recipient
- subject
- url.domain
- url.full
- url.original
- url.query
- user_agent.original
- network.application
- http.request.body.content
- http.request.referrer
- email.from.address
- dns.question.name
- destination.domain
