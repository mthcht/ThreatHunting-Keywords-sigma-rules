title: Simple keyword detection rule for icmptunnel
id: bcb47ba8-9844-4e0a-8595-d20bb8dc9759
status: experimental
description:
- '''icmptunnel works by encapsulating your IP traffic in ICMP echo packets and sending
  them to your own proxy server. The proxy server decapsulates the packet and forwards
  the IP traffic. The incoming IP packets which are destined for the client are again
  encapsulated in ICMP reply packets and sent back to the client. The IP traffic is
  sent in the ''data'' field of ICMP packets.'''
references:
- https://github.com/s-h-3-l-l/katoolin3
author: '@mthcht'
date: 2023/07/30
modified: 2023/08/03
tags:
- attack.T1001
- attack.T1041
- attack.T1570
- attack.TA0011
logsource:
  category:
  - endpoint
falsepositives:
- Unknown
level:
- Unknown
detection:
  selection:
    Image:
    - '*icmptunnel*'
    OriginalFileName:
    - '*icmptunnel*'
    CurrentDirectory:
    - '*icmptunnel*'
    ParentImage:
    - '*icmptunnel*'
    ParentCommandLine:
    - '*icmptunnel*'
    TargetFilename:
    - '*icmptunnel*'
    Signature:
    - '*icmptunnel*'
    signature:
    - '*icmptunnel*'
    ImageLoaded:
    - '*icmptunnel*'
    Company:
    - '*icmptunnel*'
    Description:
    - '*icmptunnel*'
    description:
    - '*icmptunnel*'
    CommandLine:
    - '*icmptunnel*'
    SourceImage:
    - '*icmptunnel*'
    TargetImage:
    - '*icmptunnel*'
    CallTrace:
    - '*icmptunnel*'
    TargetObject:
    - '*icmptunnel*'
    Details:
    - '*icmptunnel*'
    PipeName:
    - '*icmptunnel*'
    Consumer:
    - '*icmptunnel*'
    Destination:
    - '*icmptunnel*'
    Name:
    - '*icmptunnel*'
    Query:
    - '*icmptunnel*'
    NewName:
    - '*icmptunnel*'
    StartAddress:
    - '*icmptunnel*'
    StartModule:
    - '*icmptunnel*'
    StartFunction:
    - '*icmptunnel*'
    SourceHostname:
    - '*icmptunnel*'
    Device:
    - '*icmptunnel*'
    file_name:
    - '*icmptunnel*'
    file_path:
    - '*icmptunnel*'
    process:
    - '*icmptunnel*'
    original_file_name:
    - '*icmptunnel*'
    parent_process:
    - '*icmptunnel*'
    process_path:
    - '*icmptunnel*'
    service_path:
    - '*icmptunnel*'
    registry_path:
    - '*icmptunnel*'
    registry_value_data:
    - '*icmptunnel*'
    registry_value_name:
    - '*icmptunnel*'
    ContextInfo:
    - '*icmptunnel*'
    Payload:
    - '*icmptunnel*'
    ScriptBlockText:
    - '*icmptunnel*'
    ServerName:
    - '*icmptunnel*'
    TransportName:
    - '*icmptunnel*'
    NewProcessName:
    - '*icmptunnel*'
    ParentProcessName:
    - '*icmptunnel*'
    Application:
    - '*icmptunnel*'
    Product Name:
    - '*icmptunnel*'
    Threat Name:
    - '*icmptunnel*'
    Process Name:
    - '*icmptunnel*'
    Path:
    - '*icmptunnel*'
    ImagePath:
    - '*icmptunnel*'
    ServiceName:
    - '*icmptunnel*'
    ProcessPath:
    - '*icmptunnel*'
    AppName:
    - '*icmptunnel*'
    AppPath:
    - '*icmptunnel*'
    ModulePath:
    - '*icmptunnel*'
    registry.data.strings:
    - '*icmptunnel*'
    registry.path:
    - '*icmptunnel*'
    registry.value:
    - '*icmptunnel*'
    process.args:
    - '*icmptunnel*'
    process.command_line:
    - '*icmptunnel*'
    process.env_vars:
    - '*icmptunnel*'
    process.io.text:
    - '*icmptunnel*'
    process.executable:
    - '*icmptunnel*'
    process.name:
    - '*icmptunnel*'
    process.title:
    - '*icmptunnel*'
    pe.company:
    - '*icmptunnel*'
    pe.description:
    - '*icmptunnel*'
    pe.original_file_name:
    - '*icmptunnel*'
    pe.product:
    - '*icmptunnel*'
    os.full:
    - '*icmptunnel*'
    host.hostname:
    - '*icmptunnel*'
    file.fork_name:
    - '*icmptunnel*'
    file.name:
    - '*icmptunnel*'
    file.path:
    - '*icmptunnel*'
    file.target_path:
    - '*icmptunnel*'
    email.attachments.file.name:
    - '*icmptunnel*'
    email.subject:
    - '*icmptunnel*'
    dll.path:
    - '*icmptunnel*'
    device.model.name:
    - '*icmptunnel*'
    container.image.name:
    - '*icmptunnel*'
    container.name:
    - '*icmptunnel*'
    object:
    - '*icmptunnel*'
  condition: selection
fields:
- Image
- OriginalFileName
- CurrentDirectory
- ParentImage
- ParentCommandLine
- TargetFilename
- Signature
- signature
- ImageLoaded
- Company
- Description
- description
- CommandLine
- SourceImage
- TargetImage
- CallTrace
- TargetObject
- Details
- PipeName
- Consumer
- Destination
- Name
- Query
- NewName
- StartAddress
- StartModule
- StartFunction
- SourceHostname
- Device
- file_name
- file_path
- process
- original_file_name
- parent_process
- process_path
- service_path
- registry_path
- registry_value_data
- registry_value_name
- ContextInfo
- Payload
- ScriptBlockText
- ServerName
- TransportName
- NewProcessName
- ParentProcessName
- Application
- Product Name
- Threat Name
- Process Name
- Path
- ImagePath
- ServiceName
- ProcessPath
- AppName
- AppPath
- ModulePath
- registry.data.strings
- registry.path
- registry.value
- process.args
- process.command_line
- process.env_vars
- process.io.text
- process.executable
- process.name
- process.title
- pe.company
- pe.description
- pe.original_file_name
- pe.product
- os.full
- host.hostname
- file.fork_name
- file.name
- file.path
- file.target_path
- email.attachments.file.name
- email.subject
- dll.path
- device.model.name
- container.image.name
- container.name
- object
