title: Simple keyword detection rule for impersonate-rs
id: 2cd636a1-2575-40d1-a02b-4ca95474c51a
status: experimental
description:
- '''Reimplementation of Defte Impersonate in plain Rust allow you to impersonate
  any user on the target computer as long as you have administrator privileges (No
  NT SYSTEM needed) and is usable with and without GUI'''
references:
- https://github.com/zblurx/impersonate-rs
author: '@mthcht'
date: 2023/07/30
modified: 2023/08/25
tags:
- attack.T1003
- attack.T1008
- attack.T1071
- attack.T1134
- attack.TA0004
- attack.TA0006
- attack.TA0011
logsource:
  category:
  - endpoint
  - network
falsepositives:
- Unknown
level:
- Unknown
detection:
  selection:
    Image:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    OriginalFileName:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    CurrentDirectory:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    ParentImage:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    ParentCommandLine:
    - '*/impersonate-rs*'
    - '* exec * -p * -c *'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    - '* exec * --pid * --command *'
    TargetFilename:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    Signature:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    signature:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    ImageLoaded:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    Company:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    Description:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    description:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    CommandLine:
    - '*/impersonate-rs*'
    - '* exec * -p * -c *'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    - '* exec * --pid * --command *'
    SourceImage:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    TargetImage:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    CallTrace:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    TargetObject:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    Details:
    - '*/impersonate-rs*'
    - '* exec * -p * -c *'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    - '* exec * --pid * --command *'
    PipeName:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    Consumer:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    Destination:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    Name:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    Query:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    NewName:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    StartAddress:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    StartModule:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    StartFunction:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    SourceHostname:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    Device:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    file_name:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    file_path:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    process:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    original_file_name:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    parent_process:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    process_path:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    service_path:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    registry_path:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    registry_value_data:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    registry_value_name:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    ContextInfo:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    Payload:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    ScriptBlockText:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    ServerName:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    TransportName:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    NewProcessName:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    ParentProcessName:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    Application:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    Product Name:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    Threat Name:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    Process Name:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    Path:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    ImagePath:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    ServiceName:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    ProcessPath:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    AppName:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    AppPath:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    ModulePath:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    registry.data.strings:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    registry.path:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    registry.value:
    - '*/impersonate-rs*'
    - '* exec * -p * -c *'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    - '* exec * --pid * --command *'
    process.args:
    - '*/impersonate-rs*'
    - '* exec * -p * -c *'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    - '* exec * --pid * --command *'
    process.command_line:
    - '*/impersonate-rs*'
    - '* exec * -p * -c *'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    - '* exec * --pid * --command *'
    process.env_vars:
    - '*/impersonate-rs*'
    - '* exec * -p * -c *'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    - '* exec * --pid * --command *'
    process.io.text:
    - '*/impersonate-rs*'
    - '* exec * -p * -c *'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    - '* exec * --pid * --command *'
    process.executable:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    process.name:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    process.title:
    - '*/impersonate-rs*'
    - '* exec * -p * -c *'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    - '* exec * --pid * --command *'
    pe.company:
    - '*/impersonate-rs*'
    - '* exec * -p * -c *'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    - '* exec * --pid * --command *'
    pe.description:
    - '*/impersonate-rs*'
    - '* exec * -p * -c *'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    - '* exec * --pid * --command *'
    pe.original_file_name:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    pe.product:
    - '*/impersonate-rs*'
    - '* exec * -p * -c *'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    - '* exec * --pid * --command *'
    os.full:
    - '*/impersonate-rs*'
    - '* exec * -p * -c *'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    - '* exec * --pid * --command *'
    host.hostname:
    - '*/impersonate-rs*'
    - '* exec * -p * -c *'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    - '* exec * --pid * --command *'
    file.fork_name:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    file.name:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    file.path:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    file.target_path:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    email.attachments.file.name:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    email.subject:
    - '*/impersonate-rs*'
    - '* exec * -p * -c *'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    - '* exec * --pid * --command *'
    dll.path:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    device.model.name:
    - '*/impersonate-rs*'
    - '* exec * -p * -c *'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    - '* exec * --pid * --command *'
    container.image.name:
    - '*/impersonate-rs*'
    - '* exec * -p * -c *'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    - '* exec * --pid * --command *'
    container.name:
    - '*/impersonate-rs*'
    - '* exec * -p * -c *'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    - '* exec * --pid * --command *'
    object:
    - '*/impersonate-rs*'
    - '*irs.exe exec*'
    - '*irs.exe list*'
    - '*\irs.exe*'
    - '*irs.exe -*'
    - '*/irs.exe*'
    url:
    - '*/impersonate-rs*'
    - '*/irs.exe*'
    dest_url:
    - '*/impersonate-rs*'
    - '*/irs.exe*'
    uri:
    - '*/impersonate-rs*'
    - '*/irs.exe*'
    uri_query:
    - '*/impersonate-rs*'
    - '*/irs.exe*'
    query:
    - '*/impersonate-rs*'
    - '*/irs.exe*'
    url_domain:
    - '*/impersonate-rs*'
    - '*/irs.exe*'
    uri_path:
    - '*/impersonate-rs*'
    - '*/irs.exe*'
    domain:
    - '*/impersonate-rs*'
    - '*/irs.exe*'
    QueryName:
    - '*/impersonate-rs*'
    - '*/irs.exe*'
    QueryResults:
    - '*/impersonate-rs*'
    - '*/irs.exe*'
    DestinationHostname:
    - '*/impersonate-rs*'
    - '*/irs.exe*'
    DestinationIp:
    - '*/impersonate-rs*'
    - '*/irs.exe*'
    http_referrer:
    - '*/impersonate-rs*'
    - '*/irs.exe*'
    http_referrer_domain:
    - '*/impersonate-rs*'
    - '*/irs.exe*'
    http_user_agent:
    - '*/impersonate-rs*'
    - '*/irs.exe*'
    dest_nt_host:
    - '*/impersonate-rs*'
    - '*/irs.exe*'
    sender:
    - '*/impersonate-rs*'
    - '*/irs.exe*'
    recipient:
    - '*/impersonate-rs*'
    - '*/irs.exe*'
    orig_recipient:
    - '*/impersonate-rs*'
    - '*/irs.exe*'
    subject:
    - '*/impersonate-rs*'
    - '*/irs.exe*'
    url.domain:
    - '*/impersonate-rs*'
    - '*/irs.exe*'
    url.full:
    - '*/impersonate-rs*'
    - '*/irs.exe*'
    url.original:
    - '*/impersonate-rs*'
    - '*/irs.exe*'
    url.query:
    - '*/impersonate-rs*'
    - '*/irs.exe*'
    user_agent.original:
    - '*/impersonate-rs*'
    - '*/irs.exe*'
    network.application:
    - '*/impersonate-rs*'
    - '*/irs.exe*'
    http.request.body.content:
    - '*/impersonate-rs*'
    - '*/irs.exe*'
    http.request.referrer:
    - '*/impersonate-rs*'
    - '*/irs.exe*'
    email.from.address:
    - '*/impersonate-rs*'
    - '*/irs.exe*'
    dns.question.name:
    - '*/impersonate-rs*'
    - '*/irs.exe*'
    destination.domain:
    - '*/impersonate-rs*'
    - '*/irs.exe*'
    event.original:
    - '* exec * -p * -c *'
    - '* exec * --pid * --command *'
  condition: selection
fields:
- Image
- OriginalFileName
- CurrentDirectory
- ParentImage
- ParentCommandLine
- TargetFilename
- Signature
- signature
- ImageLoaded
- Company
- Description
- description
- CommandLine
- SourceImage
- TargetImage
- CallTrace
- TargetObject
- Details
- PipeName
- Consumer
- Destination
- Name
- Query
- NewName
- StartAddress
- StartModule
- StartFunction
- SourceHostname
- Device
- file_name
- file_path
- process
- original_file_name
- parent_process
- process_path
- service_path
- registry_path
- registry_value_data
- registry_value_name
- ContextInfo
- Payload
- ScriptBlockText
- ServerName
- TransportName
- NewProcessName
- ParentProcessName
- Application
- Product Name
- Threat Name
- Process Name
- Path
- ImagePath
- ServiceName
- ProcessPath
- AppName
- AppPath
- ModulePath
- registry.data.strings
- registry.path
- registry.value
- process.args
- process.command_line
- process.env_vars
- process.io.text
- process.executable
- process.name
- process.title
- pe.company
- pe.description
- pe.original_file_name
- pe.product
- os.full
- host.hostname
- file.fork_name
- file.name
- file.path
- file.target_path
- email.attachments.file.name
- email.subject
- dll.path
- device.model.name
- container.image.name
- container.name
- object
- url
- dest_url
- uri
- uri_query
- query
- url_domain
- uri_path
- domain
- QueryName
- QueryResults
- DestinationHostname
- DestinationIp
- http_referrer
- http_referrer_domain
- http_user_agent
- dest_nt_host
- sender
- recipient
- orig_recipient
- subject
- url.domain
- url.full
- url.original
- url.query
- user_agent.original
- network.application
- http.request.body.content
- http.request.referrer
- email.from.address
- dns.question.name
- destination.domain
- event.original
